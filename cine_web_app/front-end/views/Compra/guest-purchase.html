<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra como Invitado</title>
    <link rel="stylesheet" href="/cine_web_app/front-end/css/header.css">
    <link rel="stylesheet" href="/cine_web_app/front-end/css/purchse-guest.css">
    <link rel="stylesheet" href="/cine_web_app/front-end/css/Scrollbar.css">
    <!-- <link rel="stylesheet" href="/cine_web_app/front-end/css/butacas.css"> -->
</head>

<body>
    <!-- Encabezado principal -->
    <header class="header header--desktop">
        <a href="/cine_web_app/front-end/views/home.html" class="header__logo">Elixium</a>
        <nav class="header__nav">
            <ul class="header__menu">
                <li class="header__menu-item"><a href="/cine_web_app/front-end/views/Cinemas.html">Cines</a></li>
                <li class="header__menu-item"><a href="#">Películas</a></li>
                <li class="header__menu-item"><a href="#">Promociones</a></li>
            </ul>
        </nav>
        <div class="header__actions">
            <a href="/cine_web_app/front-end/views/security/register.html"
                class="header__link header__register">Registrarse</a>
            <a href="/cine_web_app/front-end/views/security/login.html" class="header__link header__login">Iniciar
                sesión</a>
        </div>
    </header>


    <section class="movie-details">
        <div class="movie-details__backdrop">
            <!-- Imagen de fondo de la película -->
            <img src="" alt="Banner de la película" class="movie-details__background-image">
        </div>

        <div class="movie-details__content-wrapper flex">
            <div class="movie-details__info-wrapper movie-details__info-wrapper--poster">
                <div class="movie-title">
                    <h2 class="movie-title__text movie__title"></h2>
                </div>
            </div>

            <div class="movie-details__session-info">
                <div class="session-info-container">
                    <div class="session-details">
                        <!-- La información de la sesión (cine, fecha y sala) se insertará aquí -->
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Sección principal para la compra como invitado -->
    <main class="guest-purchase">
        <section class="ticket-selection">
            <h2 class="section-title">DETALLES DE TU COMPRA</h2>
            <div class="ticket-table">
                <div class="table-row table-header">
                    <span>ARTÍCULO</span>
                    <span>PRECIO</span>
                </div>
            </div>
        </section>
        <section class="total-summary">
            <div class="total-line">
                <span>Total</span>
                <span id="final-total">0,00 €</span>
            </div>
            <p class="extra-info">Gastos de gestión, IVA y recargos incluidos <a href="#">ver detalles</a></p>
            <button id="finalize-purchase" class="continue-btn">Continuar</button>
        </section>
    </main>
    
    


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const ticketTable = document.querySelector('.ticket-table');
            const totalSummary = document.getElementById('final-total');
        
            // Obtener parámetros de la URL
            const params = new URLSearchParams(window.location.search);
            const seats = params.get('seats') ? params.get('seats').split(',') : [];
            const totalPrice = parseFloat(params.get('totalPrice')) || 0; // Precio de las entradas
            const cartProducts = params.get('cartProducts') ? JSON.parse(params.get('cartProducts')) : []; // Productos del carrito
            const cartTotal = parseFloat(params.get('cartTotal')) || 0; // Total de la compra (entradas + productos)
        
            // Renderizar entradas
            function renderTickets() {
                const ticketRow = document.createElement('div');
                ticketRow.classList.add('table-row');
                ticketRow.innerHTML = `
                    <span>${seats.length}x Entrada</span>
                    <span>${totalPrice.toFixed(2)} €</span>
                `;
                ticketTable.appendChild(ticketRow);
            }
        
            // Renderizar productos
            function renderProducts() {
                cartProducts.forEach(product => {
                    const productRow = document.createElement('div');
                    productRow.classList.add('table-row');
                    productRow.innerHTML = `
                        <span>${product.quantity}x ${product.name}</span>
                        <span>${(product.price * product.quantity).toFixed(2)} €</span>
                    `;
                    ticketTable.appendChild(productRow);
                });
            }
        
            // Mostrar el total final
            function renderTotal() {
                // Aquí usamos directamente `cartTotal`, ya que incluye entradas + productos
                totalSummary.textContent = `${cartTotal.toFixed(2)} €`;
            }
        
            // Renderizar la página completa
            function renderPage() {
                renderTickets();  // Muestra las entradas
                renderProducts(); // Muestra los productos
                renderTotal();    // Muestra el total directamente desde `cartTotal`
            }
        
            renderPage(); // Inicia el renderizado
        });
        
    </script>
    

    <script src="/cine_web_app/front-end/js/Cine/SeatSelection.js"></script>
</body>

</html>
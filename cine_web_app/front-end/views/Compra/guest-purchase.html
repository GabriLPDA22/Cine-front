<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra como Invitado</title>
    <link rel="stylesheet" href="/cine_web_app/front-end/css/header.css">
    <link rel="stylesheet" href="/cine_web_app/front-end/css/purchse-guest.css">
    <link rel="stylesheet" href="/cine_web_app/front-end/css/Scrollbar.css">
    <!-- <link rel="stylesheet" href="/cine_web_app/front-end/css/butacas.css"> -->
</head>

<body>
    <!-- Encabezado principal -->
    <header class="header header--desktop">
        <a href="/cine_web_app/front-end/views/home.html" class="header__logo">Elixium</a>
        <nav class="header__nav">
            <ul class="header__menu">
                <li class="header__menu-item"><a href="/cine_web_app/front-end/views/Cinemas.html">Cines</a></li>
                <li class="header__menu-item"><a href="#">Películas</a></li>
                <li class="header__menu-item"><a href="#">Promociones</a></li>
            </ul>
        </nav>
        <div class="header__actions">
            <a href="/cine_web_app/front-end/views/security/register.html"
                class="header__link header__register">Registrarse</a>
            <a href="/cine_web_app/front-end/views/security/login.html" class="header__link header__login">Iniciar
                sesión</a>
        </div>
    </header>


    <section class="movie-details">
        <div class="movie-details__backdrop">
            <!-- Imagen de fondo de la película -->
            <img src="" alt="Banner de la película" class="movie-details__background-image">
        </div>

        <div class="movie-details__content-wrapper flex">
            <div class="movie-details__info-wrapper movie-details__info-wrapper--poster">
                <div class="movie-title">
                    <h2 class="movie-title__text movie__title"></h2>
                </div>
            </div>

            <div class="movie-details__session-info">
                <div class="session-info-container">
                    <div class="session-details">
                        <!-- La información de la sesión (cine, fecha y sala) se insertará aquí -->
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Sección principal para la compra como invitado -->
    <main class="guest-purchase">
        <section class="ticket-selection">
            <h2 class="section-title">TUS ENTRADAS</h2>
            <div class="promo-code">
                <label for="promo-code-input">Introduce tu código promocional</label>
                <input type="text" id="promo-code-input" placeholder="Código promocional">
            </div>
            <div class="ticket-table">
                <div class="table-row table-header">
                    <span>ARTÍCULO</span>
                    <span>PRECIO</span>
                    <span>CANTIDAD</span>
                    <span>TOTAL</span>
                </div>
                <div class="table-row">
                    <span>-Especial Online</span>
                    <span>6,90 €</span>
                    <div class="quantity-selector">
                        <button class="decrement">-</button>
                        <span class="quantity">0</span>
                        <button class="increment">+</button>
                    </div>
                    <span>0,00 €</span>
                </div>
            </div>
        </section>
        <section class="total-summary">
            <div class="total-line">
                <span>Total</span>
                <span>0,00 €</span>
            </div>
            <div class="ticket-status">
                <p class="extra-info" id="selected-count">Entradas seleccionadas: 0/0</p>
            </div>
            <p class="extra-info">Gastos de gestión, IVA y recargos incluidos <a href="#">ver detalles</a></p>
            <button id="continue-to-bar" class="continue-btn" disabled>Ir a Productos Bar</button>
        </section>
    </main>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const incrementBtn = document.querySelector('.increment');
            const decrementBtn = document.querySelector('.decrement');
            const quantityDisplay = document.querySelector('.quantity');
            const totalDisplay = document.querySelector('.total-line span:last-child');
            const selectedCountDisplay = document.getElementById('selected-count');
            const continueToBarBtn = document.getElementById('continue-to-bar');
    
            const pricePerTicket = 6.9; // Precio por entrada
            let quantity = 0;
    
            // Obtener el parámetro `seats` de la URL
            const params = new URLSearchParams(window.location.search);
            const selectedSeats = params.get('seats') ? params.get('seats').split(',') : [];
            const maxSeats = selectedSeats.length; // El máximo de entradas es igual al número de asientos seleccionados
    
            if (maxSeats <= 0) {
                alert("No has seleccionado entradas. Verifica la URL.");
                return;
            }
    
            // Inicializar el contador en el HTML
            function updateDisplay() {
                quantityDisplay.textContent = quantity; // Actualiza el contador de cantidad seleccionada
                totalDisplay.textContent = `${(quantity * pricePerTicket).toFixed(2)} €`; // Calcula el total
                selectedCountDisplay.textContent = `Entradas seleccionadas: ${quantity}/${maxSeats}`; // Muestra cantidad seleccionada
                toggleContinueButton(); // Actualiza el botón de continuar
            }
    
            // Habilitar/deshabilitar el botón de continuar
            function toggleContinueButton() {
                continueToBarBtn.disabled = quantity !== maxSeats; // Activa solo si el número seleccionado es igual al requerido
            }
    
            // Aumentar la cantidad
            incrementBtn.addEventListener('click', () => {
                if (quantity < maxSeats) {
                    quantity++;
                    updateDisplay();
                } else {
                    alert(`No puedes seleccionar más de ${maxSeats} entradas.`);
                }
            });
    
            // Disminuir la cantidad
            decrementBtn.addEventListener('click', () => {
                if (quantity > 0) {
                    quantity--;
                    updateDisplay();
                }
            });
    
            // Redirigir a la página de productos de bar con los parámetros de URL
            continueToBarBtn.addEventListener('click', () => {
                if (quantity === maxSeats) {
                    params.set('totalTickets', quantity);
                    params.set('totalPrice', (quantity * pricePerTicket).toFixed(2));
                    window.location.href = `/cine_web_app/front-end/views/Compra/Productos-bar.html?${params.toString()}`;
                } else {
                    alert('Selecciona todas las entradas antes de continuar.');
                }
            });
    
            // Inicializar la visualización
            updateDisplay();
        });
    </script>
    

    <script src="/cine_web_app/front-end/js/Cine/SeatSelection.js"></script>
</body>

</html>